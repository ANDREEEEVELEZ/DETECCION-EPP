{% extends "layouts/base.html" %}

{% block title %}Dashboard - EPPVISION{% endblock %}

{% block page_title %}Dashboard Principal{% endblock %}

{% block content %}
<!-- Header con imagen de proyecto -->
<div class="relative h-48 bg-gradient-to-r from-blue-900 to-purple-900 rounded-xl overflow-hidden mb-6">
    <div class="absolute inset-0 bg-black/40"></div>
    <div class="relative z-10 p-8 h-full flex flex-col justify-end">
        <span class="text-sm text-blue-300 font-semibold mb-2">PROYECTO #2025</span>
        <h1 class="text-3xl font-bold text-white">Resumen General - Obra Costanera</h1>
    </div>
</div>

<!-- Cards de métricas principales -->
<div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
    <!-- Cumplimiento Global -->
    <div class="bg-[#1E293B] border border-gray-800 rounded-xl p-6 card-hover transition-all">
        <div class="flex items-start justify-between mb-4">
            <div class="w-12 h-12 bg-green-900/20 rounded-lg flex items-center justify-center">
                <i data-lucide="shield-check" class="w-6 h-6 text-green-500"></i>
            </div>
            <span class="text-sm text-green-400 font-semibold">+2%</span>
        </div>
        <p class="text-sm text-gray-400 mb-1">Cumplimiento Global</p>
        <p class="text-4xl font-bold text-white">87%</p>
    </div>
    
    <!-- Alertas Críticas -->
    <div class="bg-[#1E293B] border border-gray-800 rounded-xl p-6 card-hover transition-all">
        <div class="flex items-start justify-between mb-4">
            <div class="w-12 h-12 bg-red-900/20 rounded-lg flex items-center justify-center">
                <i data-lucide="alert-triangle" class="w-6 h-6 text-red-500"></i>
            </div>
            <span class="text-sm text-green-400 font-semibold">↓ -5</span>
        </div>
        <p class="text-sm text-gray-400 mb-1">Alertas Críticas (Hoy)</p>
        <p class="text-4xl font-bold text-white">12</p>
    </div>
    
    <!-- Trabajadores Monitoreados -->
    <div class="bg-[#1E293B] border border-gray-800 rounded-xl p-6 card-hover transition-all">
        <div class="flex items-start justify-between mb-4">
            <div class="w-12 h-12 bg-blue-900/20 rounded-lg flex items-center justify-center">
                <i data-lucide="users" class="w-6 h-6 text-blue-500"></i>
            </div>
            <span class="text-sm text-gray-400 font-semibold">Sin cambios</span>
        </div>
        <p class="text-sm text-gray-400 mb-1">Trabajadores Monitoreados</p>
        <p class="text-4xl font-bold text-white">145</p>
    </div>
</div>

<!-- Gráficos -->
<div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
    <!-- Tendencia de Alertas -->
    <div class="bg-[#1E293B] border border-gray-800 rounded-xl p-6">
        <div class="flex items-center justify-between mb-4">
            <h3 class="text-lg font-semibold text-white">Tendencia de Alertas</h3>
            <div class="text-sm text-gray-400">
                <span class="font-bold text-white">45</span> Total Alertas
                <span class="text-xs text-gray-500 ml-2">Últimas 24 horas</span>
            </div>
        </div>
        <canvas id="chartTendencia" height="200"></canvas>
    </div>
    
    <!-- Incumplimientos por Tipo -->
    <div class="bg-[#1E293B] border border-gray-800 rounded-xl p-6">
        <div class="flex items-center justify-between mb-4">
            <h3 class="text-lg font-semibold text-white">Incumplimientos por Tipo</h3>
            <span class="text-sm text-green-400 font-semibold">↑ +2%</span>
        </div>
        <div class="space-y-4 mt-6">
            <!-- Casco -->
            <div>
                <div class="flex items-center justify-between mb-2">
                    <div class="flex items-center space-x-2">
                        <i data-lucide="hard-hat" class="w-4 h-4 text-red-500"></i>
                        <span class="text-sm text-gray-300">Casco</span>
                    </div>
                    <span class="text-sm text-white font-semibold">42 casos</span>
                </div>
                <div class="w-full bg-gray-800 rounded-full h-2">
                    <div class="bg-red-500 h-2 rounded-full" style="width: 75%"></div>
                </div>
            </div>
            
            <!-- Chaleco -->
            <div>
                <div class="flex items-center justify-between mb-2">
                    <div class="flex items-center space-x-2">
                        <i data-lucide="shield" class="w-4 h-4 text-blue-500"></i>
                        <span class="text-sm text-gray-300">Chaleco</span>
                    </div>
                    <span class="text-sm text-white font-semibold">28 casos</span>
                </div>
                <div class="w-full bg-gray-800 rounded-full h-2">
                    <div class="bg-blue-500 h-2 rounded-full" style="width: 50%"></div>
                </div>
            </div>
            
            <!-- Gafas -->
            <div>
                <div class="flex items-center justify-between mb-2">
                    <div class="flex items-center space-x-2">
                        <i data-lucide="glasses" class="w-4 h-4 text-gray-500"></i>
                        <span class="text-sm text-gray-300">Gafas</span>
                    </div>
                    <span class="text-sm text-white font-semibold">15 casos</span>
                </div>
                <div class="w-full bg-gray-800 rounded-full h-2">
                    <div class="bg-gray-500 h-2 rounded-full" style="width: 25%"></div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Estado de Cumplimiento y Última Detección -->
<div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
    <!-- Estado de Cumplimiento (Donut) -->
    <div class="bg-[#1E293B] border border-gray-800 rounded-xl p-6">
        <h3 class="text-lg font-semibold text-white mb-4">Estado de Cumplimiento</h3>
        <div class="flex items-center justify-center">
            <div class="relative w-64 h-64">
                <canvas id="chartDonut"></canvas>
            </div>
        </div>
        <div class="grid grid-cols-3 gap-4 mt-6">
            <div>
                <div class="flex items-center space-x-2 mb-1">
                    <div class="w-3 h-3 bg-green-500 rounded-full"></div>
                    <span class="text-xs text-gray-400">Uso Correcto</span>
                </div>
                <p class="text-xl font-bold text-white">87%</p>
            </div>
            <div>
                <div class="flex items-center space-x-2 mb-1">
                    <div class="w-3 h-3 bg-orange-500 rounded-full"></div>
                    <span class="text-xs text-gray-400">Uso Incorrecto</span>
                </div>
                <p class="text-xl font-bold text-white">8%</p>
            </div>
            <div>
                <div class="flex items-center space-x-2 mb-1">
                    <div class="w-3 h-3 bg-red-500 rounded-full"></div>
                    <span class="text-xs text-gray-400">No Uso</span>
                </div>
                <p class="text-xl font-bold text-white">5%</p>
            </div>
        </div>
    </div>
    
    <!-- Última Detección de Riesgo -->
    <div class="bg-[#1E293B] border border-gray-800 rounded-xl p-6">
        <div class="flex items-center justify-between mb-4">
            <h3 class="text-lg font-semibold text-white">Última Detección de Riesgo</h3>
            <a href="/historial-alertas" class="text-sm text-blue-400 hover:text-blue-300">Ver todas las cámaras</a>
        </div>
        
        <!-- Imagen con overlay -->
        <div class="relative aspect-video bg-gray-900 rounded-lg overflow-hidden">
            <!-- Placeholder para imagen -->
            <div class="absolute inset-0 flex items-center justify-center">
                <div class="text-center">
                    <i data-lucide="image" class="w-16 h-16 text-gray-700 mx-auto mb-2"></i>
                    <p class="text-sm text-gray-500">Sin detecciones recientes</p>
                </div>
            </div>
            
            <!-- Badge de detección (solo ejemplo visual) -->
            <div class="absolute top-4 left-4 bg-red-600 text-white px-3 py-1 rounded-lg text-sm font-semibold">
                NO CASCO (85%)
            </div>
            
            <!-- Info de zona -->
            <div class="absolute bottom-4 left-4 bg-black/70 backdrop-blur-sm text-white px-3 py-2 rounded-lg">
                <p class="text-xs text-gray-300">Zona de Carga • Cámara 04</p>
                <p class="text-xs text-gray-400">Hace 2 minutos • ID Trabajador: #8325</p>
            </div>
            
            <!-- Botón de reporte -->
            <button class="absolute bottom-4 right-4 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg text-sm font-semibold transition-all">
                Crear Reporte
            </button>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// Gráfico de Tendencia de Alertas
const ctxTendencia = document.getElementById('chartTendencia').getContext('2d');
new Chart(ctxTendencia, {
    type: 'line',
    data: {
        labels: ['08:00', '12:00', '16:00', '20:00', '00:00'],
        datasets: [{
            label: 'Alertas',
            data: [0, 0, 0, 0, 0],
            borderColor: '#3B82F6',
            backgroundColor: 'rgba(59, 130, 246, 0.1)',
            fill: true,
            tension: 0.4,
            borderWidth: 2
        }]
    },
    options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
            legend: { display: false },
            tooltip: {
                backgroundColor: '#1E293B',
                titleColor: '#F1F5F9',
                bodyColor: '#F1F5F9',
                borderColor: '#334155',
                borderWidth: 1
            }
        },
        scales: {
            x: {
                grid: { color: '#334155' },
                ticks: { color: '#94A3B8' }
            },
            y: {
                grid: { color: '#334155' },
                ticks: { color: '#94A3B8' },
                beginAtZero: true
            }
        }
    }
});

// Gráfico Donut de Cumplimiento
const ctxDonut = document.getElementById('chartDonut').getContext('2d');
new Chart(ctxDonut, {
    type: 'doughnut',
    data: {
        labels: ['Uso Correcto', 'Uso Incorrecto', 'No Uso'],
        datasets: [{
            data: [0, 0, 0],
            backgroundColor: ['#10B981', '#F59E0B', '#EF4444'],
            borderWidth: 0
        }]
    },
    options: {
        responsive: true,
        maintainAspectRatio: true,
        cutout: '70%',
        plugins: {
            legend: { display: false },
            tooltip: {
                backgroundColor: '#1E293B',
                titleColor: '#F1F5F9',
                bodyColor: '#F1F5F9',
                borderColor: '#334155',
                borderWidth: 1
            }
        }
    }
});
</script>
{% endblock %}
